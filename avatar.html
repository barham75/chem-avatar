<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…Ø¤ØªÙ…Ø± â€“ Chemistry SSC2 2026</title>

  <style>
    body {
      margin: 0;
      font-family: Tahoma, Arial, sans-serif;
      direction: rtl;
      background: #020617;
      color: #e5e7eb;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 38px;
      margin-bottom: 10px;
      color: #fff;
    }

    /* --- Avatar --- */
    .avatar-box {
      width: 260px;
      height: 260px;
      margin: 25px auto;
      border-radius: 50%;
      background: #0f172a;
      border: 4px solid #22c55e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 120px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* --- Main Boxes --- */
    .box {
      width: 90%;
      max-width: 900px;
      margin: 20px auto;
      background: #0f172a;
      padding: 20px;
      border-radius: 18px;
      border: 1px solid #1e293b;
      text-align: right;
    }

    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      margin-top: 10px;
      font-size: 17px;
    }

    button {
      margin-top: 12px;
      padding: 12px 25px;
      border-radius: 10px;
      background: #22c55e;
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background: #16a34a;
    }

    audio {
      margin-top: 15px;
      width: 100%;
    }

    .label-title {
      color: #38bdf8;
      font-size: 20px;
      margin-bottom: 10px;
    }

    .text-out {
      margin-top: 6px;
      font-size: 18px;
      line-height: 1.7;
    }

  </style>
</head>

<body>

  <h1>Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…Ø¤ØªÙ…Ø± â€“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</h1>

  <!-- AVATAR -->
  <div class="avatar-box">ğŸ‘¨â€ğŸ”¬</div>

  <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ -->
  <div class="box">
    <label>Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:</label>
    <input id="question" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø§ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø¤ØªÙ…Ø±ØŸ">
    <button onclick="ask()">Ø¥Ø±Ø³Ø§Ù„</button>

    <br><br>

    <button onclick="startRecording()">ğŸ¤ Ø§Ø³Ø£Ù„ ØµÙˆØªÙŠØ§Ù‹</button>
    <button onclick="stopRecording()">â¹ Ø¥ÙŠÙ‚Ø§Ù</button>

    <audio id="audioPlayer" controls></audio>
  </div>

  <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div class="box">
    <div class="label-title">Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©):</div>
    <div id="q_en" class="text-out"></div>

    <div class="label-title" style="color:#a5b4fc;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©):</div>
    <div id="a_ar" class="text-out"></div>

    <div class="label-title" style="color:#fbbf24;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©):</div>
    <div id="a_en" class="text-out"></div>
  </div>



  <script>
    // ----------------------------------
    // Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„ Ù†ØµÙ‘ÙŠ Ø¥Ù„Ù‰ /ask
    // ----------------------------------
    async function ask() {
      const question = document.getElementById("question").value.trim();
      if (!question) return;

      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question })
      });

      const data = await res.json();

      document.getElementById("q_en").textContent = data.question_en;
      document.getElementById("a_ar").textContent = data.answer_ar;
      document.getElementById("a_en").textContent = data.answer_en;

      // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
      if (data.voice) {
        const audio = document.getElementById("audioPlayer");
        audio.src = "data:audio/wav;base64," + data.voice;
        audio.play();
      }
    }



    // ----------------------------------
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª
    // ----------------------------------
    let mediaRecorder;
    let audioChunks = [];

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

      mediaRecorder.onstop = async () => {
        const blob = new Blob(audioChunks, { type: "audio/webm" });
        const formData = new FormData();
        formData.append("audio", blob, "speech.webm");

        const res = await fetch("/stt", { method: "POST", body: formData });
        const data = await res.json();

        document.getElementById("question").value = data.text;  // ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
      };

      mediaRecorder.start();
      alert("ğŸ™ Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...");
    }

    function stopRecording() {
      if (mediaRecorder) {
        mediaRecorder.stop();
        alert("â¹ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„");
      }
    }

  </script>

</body>
</html>
