<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…Ø¤ØªÙ…Ø± â€“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</title>

<style>
    body {
        margin: 0;
        background: #020617;
        font-family: Tahoma, Arial;
        direction: rtl;
        text-align: center;
        color: white;
        padding: 20px;
    }

    .avatar {
        width: 220px;
        height: 220px;
        margin: 20px auto;
        border-radius: 50%;
        background: #0f172a;
        border: 4px solid #22c55e;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 110px;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.07); }
        100% { transform: scale(1); }
    }

    input {
        width: 80%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        margin-top: 10px;
        font-size: 18px;
    }

    button {
        padding: 10px 20px;
        margin-top: 10px;
        border: none;
        background: #22c55e;
        color: black;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
    }

    .box {
        width: 90%;
        margin: 20px auto;
        background: #0f172a;
        padding: 15px;
        border-radius: 15px;
        border: 1px solid #1e293b;
        text-align: right;
    }
</style>
</head>

<body>

<h1>Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…Ø¤ØªÙ…Ø± â€“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</h1>

<div class="avatar">ğŸ‘¨â€ğŸ”¬</div>

<div class="box">
    <label>Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ:</label>
    <input id="question" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø§ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø¤ØªÙ…Ø±ØŸ" />

    <button onclick="ask()">Ø¥Ø±Ø³Ø§Ù„</button>
    <br><br>

    <button onclick="startRecording()">ğŸ¤ Ø§Ø³Ø£Ù„ ØµÙˆØªÙŠØ§Ù‹</button>
    <button onclick="stopRecording()">â¹ Ø¥ÙŠÙ‚Ø§Ù</button>

    <audio id="audioPlayer" controls></audio>
</div>

<div class="box">
    <h3>Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)</h3>
    <div id="q_en" style="color:#38bdf8"></div>

    <h3>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</h3>
    <div id="a_ar" style="color:#a5b4fc"></div>

    <h3>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)</h3>
    <div id="a_en" style="color:#fbbf24"></div>
</div>


<script>
async function ask() {
    const q = document.getElementById("question").value.trim();
    if (!q) return;

    const res = await fetch("/ask", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ question: q })
    });

    const data = await res.json();

    document.getElementById("q_en").textContent = data.question_en;
    document.getElementById("a_ar").textContent = data.answer_ar;
    document.getElementById("a_en").textContent = data.answer_en;

    if (data.voice) {
        const audio = document.getElementById("audioPlayer");
        audio.src = "data:audio/wav;base64," + data.voice;
        audio.play();
    }
}

let recorder;
let audioChunks = [];

async function startRecording() {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);

    audioChunks = [];
    recorder.ondataavailable = e => audioChunks.push(e.data);

    recorder.onstop = async () => {
        const blob = new Blob(audioChunks, { type: "audio/webm" });
        const fd = new FormData();
        fd.append("audio", blob, "speech.webm");

        const res = await fetch("/stt", { method: "POST", body: fd });
        const data = await res.json();
        document.getElementById("question").value = data.text;
    };

    recorder.start();
    alert("ğŸ™ Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...");
}

function stopRecording() {
    if (recorder) {
        recorder.stop();
        alert("â¹ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„");
    }
}
</script>

</body>
</html>
